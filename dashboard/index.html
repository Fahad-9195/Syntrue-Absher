<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>ููุญุฉ ุงูุฃูุงู ุงูุฐูู - Smart Security Dashboard</title>

    <link rel="stylesheet" href="styles.css" />

    <!-- Leaflet -->
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Heatmap -->
    <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <!-- ุดุฑูุท ุงูุฃูููุงูู -->
    <div id="offline-banner" class="offline-banner" style="display:none;">
        โ๏ธ ููุฏ ุงูุงุชุตุงู ุจุงูุฎุงุฏู ูุคูุชูุงุ ุณูุชู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู...
    </div>

    <main class="dashboard">
        <!-- ุงูููุฏุฑ -->
        <header class="dashboard-header">
            <div>
                <h1>ููุญุฉ ุงูุฃูุงู ุงูุฐูู (ูุญุงูุงุฉ ููุตุฉ ุฃุจุดุฑ)</h1>
                <p class="subtitle">ูุฑุงูุจุฉ ุฃุฌูุฒุฉ ุงูุฃูุงู ุงูููุฒูู ูุญุธููุง</p>
                <p id="context-info" class="subtitle">
                    ๐ค ุญุณุงุจ ุฃุจุดุฑ: <strong>1234567890</strong> โข ๐ ููุฒู: <strong>HOME-1234</strong>
                </p>
            </div>

            <div class="header-controls">
                <div id="connection-status" class="conn-status">
                    <span class="conn-dot"></span> ูุชู ุงููุญุต...
                </div>

                <select id="view-mode" class="view-mode-select">
                    <option value="owner">ูุถุน ุตุงุญุจ ุงูููุฒู</option>
                    <option value="ops">ูุถุน ุบุฑูุฉ ุงูุนูููุงุช</option>
                </select>

                <button id="toggle-fetch-btn" class="toggle-btn">โธ ุฅููุงู ุงูุชุญุฏูุซ</button>
                <button id="theme-toggle-btn" class="theme-btn">โ๏ธ ุงููุถุน ุงููุงุชุญ</button>
                <button id="go-reports-btn" class="export-btn">๐ ุตูุญุฉ ุงูุชูุงุฑูุฑ</button>
            </div>
        </header>

        <!-- ุงููุฑูุช ุงูุนูููุฉ -->
        <section class="stats">
            <div class="card">
                <h2>ุงูุจูุงุบุงุช ุงูููุชูุญุฉ ุงูุขู</h2>
                <p id="total-events" class="big-number">0</p>
            </div>

            <div class="card danger-card">
                <h2>ุญุงูุงุช ุงูุฎุทุฑ ุงูููุชูุญุฉ</h2>
                <p id="danger-count" class="big-number">0</p>
            </div>

            <div class="card">
                <h2>ูุณุชูู ุงูุฎุทุฑ ุงูุนุงู</h2>
                <div class="risk-wrapper">
                    <div class="risk-bar">
                        <div id="risk-bar-fill"></div>
                    </div>
                    <p id="risk-label" class="muted">ูุง ุชูุฌุฏ ุจูุงูุงุช</p>
                </div>
            </div>

            <div class="card">
                <h2>ุขุฎุฑ ุญุฏุซ</h2>
                <p id="last-event" class="muted">ูุง ููุฌุฏ ุจูุงูุงุช</p>
            </div>
        </section>

        <!-- ูุฑุช ุฎุงุต ุจูุถุน ุงูุฏูุฑูุงุช ุงูุณุฑูุฉ -->
<section class="officer-section">
    <div class="card officer-card">
        <h2>ูุถุน ุงูุฏูุฑูุงุช ุงูุณุฑูุฉ</h2>
        <p id="officer-summary-text" class="muted">
            ูุง ุชูุฌุฏ ุจูุงูุงุช ุนู ุงูุฏูุฑูุงุช ุญุชู ุงูุขู.
        </p>

        <div class="officer-status-row">
            <span>๐ข ุขูู: <strong id="officer-safe-count">0</strong></span>
            <span>๐ ุบูุฑ ูุณุชูุฑ: <strong id="officer-unstable-count">0</strong></span>
            <span>๐ด ุทุงุฑุฆ: <strong id="officer-emergency-count">0</strong></span>
        </div>

        <button id="officer-view-toggle" class="toggle-btn officer-toggle-btn">
            ๐ ุชูุนูู ูุถุน ุงูุฏูุฑูุงุช ุงูุณุฑูุฉ
        </button>
    </div>
</section>


        <!-- ุฎุฑูุทุฉ + ุชุดุงุฑุช -->
        <section class="map-section">
            <div class="card">
                <div class="card-header">
                    <h2>ุฎุฑูุทุฉ ุงูููุฒู + Heatmap</h2>
                </div>
                <div id="map"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>ูุฎุทุท ุญู ูุนุฏุฏ ุงูุฃุญุฏุงุซ</h2>
                </div>
                <canvas id="liveChart" height="120"></canvas>
            </div>
        </section>

        <!-- ุฌููุฉ ุฃูููุฉ -->
        <section class="patrol-section">
            <div class="card">
                <div class="card-header">
                    <h2>ุฌููุฉ ุฃูููุฉ ุฐููุฉ (ุฏูุฑูุฉ + ุฏุฑูู)</h2>
                </div>
                <div id="patrol-map"></div>
            </div>
        </section>

        <section class="map-section">
    <div class="card">
        <div class="card-header">
            <h2>ุฎุฑูุทุฉ ุงูุฏูุฑูุงุช ุงูุณุฑููุฉ</h2>
            <span class="auto-refresh">
                ููุงูุน ุงูุนุณูุฑ + ุญุฑุงุฑุฉ ุงููุดุงุท ุงูุฃููู + ุฎุทูุท ุงูุงุชุตุงู
            </span>
        </div>
        <div id="officers-map"></div>
    </div>
</section>


        <!-- ููุฎุต ุงูุฃุฌูุฒุฉ -->
        <section class="events-section">
            <div class="card">
                <div class="card-header">
                    <h2>ุงูุฃุฌูุฒุฉ ุงููุดุทุฉ</h2>
                </div>
                <ul id="devices-summary" class="devices-summary"></ul>
            </div>
        </section>

        <!-- ุฌุฏูู ุงูุฃุญุฏุงุซ -->
        <section class="events-section">
            <div class="events-header">
                <h2>ูุงุฆูุฉ ุงูุฃุญุฏุงุซ</h2>
                <div style="display:flex; gap:8px; flex-wrap:wrap;">
                    <button id="resolve-all-btn" class="export-btn">โ ุญูู ุฌููุน ุงูุจูุงุบุงุช ุงูููุชูุญุฉ</button>
                    <button id="export-excel-btn" class="export-btn">โฌ๏ธ ุชุตุฏูุฑ CSV</button>
                    <button id="import-excel-btn" class="export-btn">โฌ๏ธ ุงุณุชูุฑุงุฏ CSV</button>
                    <input type="file" id="file-input" accept=".csv" style="display:none;">
                </div>
            </div>

            <div class="filters">
                <div class="filter-group">
                    <label for="level-filter">ูุณุชูู ุงูุฎุทูุฑุฉ</label>
                    <select id="level-filter">
                        <option value="all">ุงููู</option>
                        <option value="info">Info</option>
                        <option value="warning">Warning</option>
                        <option value="danger">Danger</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="time-filter">ุงููุฏุฉ ุงูุฒูููุฉ</label>
                    <select id="time-filter">
                        <option value="all">ูู ุงูุฃููุงุช</option>
                        <option value="5">ุขุฎุฑ 5 ุฏูุงุฆู</option>
                        <option value="15">ุขุฎุฑ 15 ุฏูููุฉ</option>
                        <option value="60">ุขุฎุฑ ุณุงุนุฉ</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="device-filter">ุงูุฌูุงุฒ</label>
                    <select id="device-filter">
                        <option value="all">ูู ุงูุฃุฌูุฒุฉ</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="status-filter">ุญุงูุฉ ุงูุจูุงุบ</label>
                    <select id="status-filter">
                        <option value="open">ููุชูุญุฉ</option>
                        <option value="resolved">ูุบููุฉ</option>
                        <option value="all">ุงููู</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>ูุถุน ุงููุญุงูุงุฉ</label>
                    <button id="simulation-toggle-btn" class="toggle-btn">
                        โถ ุชุดุบูู ุงููุญุงูุงุฉ
                    </button>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>ุงูููุช</th>
                        <th>ุงูุฌูุงุฒ</th>
                        <th>ุงูููุน</th>
                        <th>ุงูุฎุทูุฑุฉ</th>
                        <th>ุงูุญุงูุฉ</th>
                    </tr>
                </thead>
                <tbody id="events-table-body"></tbody>
            </table>
        </section>
    </main>

    <!-- Toasts -->
    <div id="toast-container"></div>

    <!-- ุตูุช ุชูุจูู -->
    <audio id="alert-sound" src="alert.mp3" preload="auto"></audio>

    <script src="app.js"></script>
</body>
</html>
